{
  "project": "Doucement - Types d'Habitudes",
  "description": "Tâches pour améliorer la gestion des différents types d'habitudes",
  "createdAt": "2026-01-11",
  "sourceDocument": "docs/habit-types-analysis.md",
  "phases": [
    {
      "id": "phase-fix",
      "name": "Corrections des habitudes suggérées",
      "status": "completed",
      "tasks": [
        {
          "id": "fix.1",
          "name": "Corriger mindfulness-breathing période",
          "description": "Changer progression.period de 'daily' à 'weekly' pour mindfulness-breathing dans suggestedHabits.ts",
          "status": "completed",
          "priority": "high",
          "files": ["src/constants/suggestedHabits.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix.2",
          "name": "Ajouter trackingMode simple à movement-walk-after-meal",
          "description": "Ajouter trackingMode: 'simple' à l'habitude movement-walk-after-meal",
          "status": "completed",
          "priority": "high",
          "files": ["src/constants/suggestedHabits.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix.3",
          "name": "Ajouter trackingMode simple à reading-before-bed",
          "description": "Ajouter trackingMode: 'simple' à l'habitude reading-before-bed",
          "status": "completed",
          "priority": "high",
          "files": ["src/constants/suggestedHabits.ts"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-decrease",
      "name": "Amélioration des habitudes à réduire",
      "status": "completed",
      "tasks": [
        {
          "id": "dec.1",
          "name": "Désactiver habit stacking pour direction decrease",
          "description": "Dans StepIntentions.tsx, ne pas afficher le sélecteur d'ancrage (HabitAnchorSelector) si la direction de l'habitude est 'decrease'. Les habitudes à réduire ne doivent pas être chaînées.",
          "status": "completed",
          "priority": "high",
          "files": ["src/components/habits/StepIntentions.tsx", "src/pages/CreateHabit.tsx"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "dec.2",
          "name": "Ajouter messages spéciaux pour valeur zéro",
          "description": "Créer des messages de félicitations spéciaux quand l'utilisateur saisit 0 pour une habitude decrease. Ajouter dans messages.ts et afficher dans HabitCard/CheckInButtons",
          "status": "completed",
          "priority": "medium",
          "files": ["src/constants/messages.ts", "src/components/habits/HabitCard.tsx"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "dec.3",
          "name": "Améliorer feedback visuel pour decrease",
          "description": "Utiliser la couleur verte (success) quand l'utilisateur fait MOINS que la cible pour une habitude decrease, car moins = mieux",
          "status": "completed",
          "priority": "medium",
          "files": ["src/components/habits/HabitCard.tsx", "src/components/habits/HabitCard.css"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-cumulative",
      "name": "Support saisie cumulative",
      "status": "completed",
      "tasks": [
        {
          "id": "cum.1",
          "name": "Ajouter type EntryMode aux types",
          "description": "Ajouter 'entryMode?: EntryMode' au type Habit où EntryMode = 'replace' | 'cumulative'. Mode par défaut: 'replace'",
          "status": "completed",
          "priority": "medium",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "cum.2",
          "name": "Implémenter logique cumulative dans useAppData",
          "description": "Modifier addEntry pour additionner la valeur si entryMode='cumulative' au lieu de remplacer",
          "status": "completed",
          "priority": "medium",
          "files": ["src/hooks/useAppData.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "cum.3",
          "name": "Afficher cumul dans HabitCard",
          "description": "Afficher 'X (total aujourd'hui)' pour les habitudes en mode cumulative",
          "status": "completed",
          "priority": "medium",
          "files": ["src/components/habits/HabitCard.tsx"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "cum.4",
          "name": "Ajouter option cumulative dans CreateHabit",
          "description": "Permettre de choisir le mode de saisie (remplacer/cumuler) lors de la création d'habitude",
          "status": "completed",
          "priority": "low",
          "files": ["src/pages/CreateHabit.tsx"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "cum.5",
          "name": "Migration schéma pour entryMode",
          "description": "Créer la migration pour le nouveau champ entryMode dans les habitudes existantes",
          "status": "completed",
          "priority": "medium",
          "files": ["src/services/migration.ts", "src/types/index.ts"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-tests-fixtures",
      "name": "Fixtures de test pour types d'habitudes",
      "status": "completed",
      "tasks": [
        {
          "id": "fix-test.1",
          "name": "Créer fixture increase-daily.json",
          "description": "Fichier de test avec habitude direction=increase, trackingFrequency=daily, avec entrées variées",
          "status": "completed",
          "priority": "high",
          "files": ["public/test-data/habit-types/increase-daily.json"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix-test.2",
          "name": "Créer fixture increase-weekly.json",
          "description": "Fichier de test avec habitude direction=increase, trackingFrequency=weekly",
          "status": "completed",
          "priority": "high",
          "files": ["public/test-data/habit-types/increase-weekly.json"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix-test.3",
          "name": "Créer fixture decrease-daily.json",
          "description": "Fichier de test avec habitude direction=decrease, avec entrées montrant que moins=mieux",
          "status": "completed",
          "priority": "high",
          "files": ["public/test-data/habit-types/decrease-daily.json"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix-test.4",
          "name": "Créer fixture decrease-weekly.json",
          "description": "Fichier de test avec habitude direction=decrease, trackingFrequency=weekly (ex: alcool)",
          "status": "completed",
          "priority": "high",
          "files": ["public/test-data/habit-types/decrease-weekly.json"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix-test.5",
          "name": "Créer fixture maintain-simple.json",
          "description": "Fichier de test avec habitude direction=maintain, trackingMode=simple",
          "status": "completed",
          "priority": "medium",
          "files": ["public/test-data/habit-types/maintain-simple.json"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "fix-test.6",
          "name": "Créer fixture decrease-zero.json",
          "description": "Fichier de test avec habitude decrease ayant une entrée à 0 pour tester les messages de victoire",
          "status": "completed",
          "priority": "medium",
          "files": ["public/test-data/habit-types/decrease-zero.json"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-tests-e2e",
      "name": "Tests E2E par type d'habitude",
      "status": "completed",
      "tasks": [
        {
          "id": "e2e-type.1",
          "name": "Test E2E habitude increase daily",
          "description": "Test création et check-in d'une habitude increase/daily. Vérifier que >= cible = succès avec feedback positif",
          "status": "completed",
          "priority": "high",
          "files": ["e2e/habit-increase-daily.spec.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "e2e-type.2",
          "name": "Test E2E habitude increase weekly",
          "description": "Test habitude hebdomadaire. Vérifier l'affichage X/Y, le compteur qui s'incrémente chaque jour fait",
          "status": "completed",
          "priority": "high",
          "files": ["e2e/habit-increase-weekly.spec.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "e2e-type.3",
          "name": "Test E2E habitude decrease daily",
          "description": "Test habitude à réduire. Vérifier que <= cible = succès, boutons adaptés (Moins = positif)",
          "status": "completed",
          "priority": "high",
          "files": ["e2e/habit-decrease-daily.spec.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "e2e-type.4",
          "name": "Test E2E saisie zéro decrease",
          "description": "Test saisie de 0 pour habitude decrease. Vérifier message de félicitations spécial",
          "status": "completed",
          "priority": "medium",
          "files": ["e2e/habit-decrease-zero.spec.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "e2e-type.5",
          "name": "Test E2E habitude maintain",
          "description": "Test habitude maintien. Vérifier pas de progression, dose fixe",
          "status": "completed",
          "priority": "medium",
          "files": ["e2e/habit-maintain.spec.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "e2e-type.6",
          "name": "Test E2E pas de habit stacking pour decrease",
          "description": "Vérifier que l'option d'ancrage n'est pas proposée lors de la création d'une habitude decrease",
          "status": "completed",
          "priority": "high",
          "files": ["e2e/habit-decrease-no-stacking.spec.ts"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-tests-unit",
      "name": "Tests unitaires",
      "status": "completed",
      "tasks": [
        {
          "id": "unit.1",
          "name": "Tests calcul score decrease",
          "description": "Tests unitaires pour vérifier que le calcul de complétion est correct pour decrease (moins = mieux)",
          "status": "completed",
          "priority": "high",
          "files": ["src/services/progression.test.ts"],
          "completedAt": "2026-01-11",
          "note": "Tests déjà présents dans progression.test.ts lignes 502-538 (calculateCompletionPercentage decrease) et 580-610 (getCompletionStatus decrease)"
        },
        {
          "id": "unit.2",
          "name": "Tests mode cumulative",
          "description": "Tests unitaires pour le mode de saisie cumulative",
          "status": "completed",
          "priority": "medium",
          "files": ["src/hooks/useAppData.test.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "unit.3",
          "name": "Tests messages zéro",
          "description": "Tests pour vérifier les messages appropriés quand valeur = 0 pour decrease",
          "status": "completed",
          "priority": "medium",
          "files": ["src/components/habits/CheckInButtons.test.tsx"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-edit-habits",
      "name": "Amélioration de l'édition des habitudes",
      "status": "completed",
      "description": "Permettre la modification de toutes les propriétés configurables d'une habitude, avec une expérience similaire à la création",
      "tasks": [
        {
          "id": "edit.1",
          "name": "Ajouter édition trackingFrequency (daily/weekly)",
          "description": "Permettre de changer la fréquence de suivi entre quotidien et hebdomadaire. Ajouter les boutons de sélection comme dans CreateHabit (step-details). ATTENTION: Ce changement peut impacter l'affichage des entrées existantes.",
          "status": "completed",
          "priority": "high",
          "files": ["src/pages/EditHabit.tsx", "src/pages/EditHabit.css"],
          "notes": "Propriété: trackingFrequency: 'daily' | 'weekly'",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.2",
          "name": "Ajouter édition entryMode (replace/cumulative)",
          "description": "Permettre de changer le mode de saisie entre remplacement et cumul. Réutiliser les composants/styles de CreateHabit (section entry-mode).",
          "status": "completed",
          "priority": "high",
          "files": ["src/pages/EditHabit.tsx", "src/pages/EditHabit.css"],
          "notes": "Propriété: entryMode: 'replace' | 'cumulative'",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.3",
          "name": "Ajouter édition identityStatement",
          "description": "Permettre de modifier ou ajouter la déclaration d'identité. Réutiliser le composant IdentityPrompt ou créer une version simplifiée pour l'édition.",
          "status": "completed",
          "priority": "medium",
          "files": ["src/pages/EditHabit.tsx", "src/pages/EditHabit.css"],
          "notes": "Propriété: identityStatement?: string",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.4",
          "name": "Ajouter édition trackingMode (simple/detailed)",
          "description": "Permettre de changer entre le mode simple (binaire fait/pas fait) et détaillé (valeur numérique). Note: Cette option n'est pas encore dans CreateHabit mais existe dans le modèle de données.",
          "status": "completed",
          "priority": "medium",
          "files": ["src/pages/EditHabit.tsx", "src/pages/EditHabit.css"],
          "notes": "Propriété: trackingMode?: 'simple' | 'detailed'",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.5",
          "name": "Ajouter édition description",
          "description": "Permettre d'ajouter ou modifier une description optionnelle pour l'habitude. Champ texte multiligne.",
          "status": "completed",
          "priority": "low",
          "files": ["src/pages/EditHabit.tsx", "src/pages/EditHabit.css"],
          "notes": "Propriété: description?: string",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.6",
          "name": "Désactiver habit stacking pour direction decrease",
          "description": "Comme pour CreateHabit, ne pas afficher le sélecteur d'ancrage si l'habitude est de type 'decrease'. Le habit stacking n'a pas de sens pour les habitudes à réduire.",
          "status": "completed",
          "priority": "high",
          "files": ["src/pages/EditHabit.tsx"],
          "notes": "Cohérence avec CreateHabit: les habitudes decrease ne peuvent pas être chaînées",
          "completedAt": "2026-01-11"
        },
        {
          "id": "edit.7",
          "name": "Harmoniser les styles avec CreateHabit",
          "description": "S'assurer que les composants d'édition utilisent les mêmes classes CSS et styles que CreateHabit pour une expérience cohérente.",
          "status": "completed",
          "priority": "low",
          "files": ["src/pages/EditHabit.css", "src/pages/CreateHabit.css"],
          "completedAt": "2026-01-11",
          "notes": "CSS refactorisé: sections regroupées avec commentaires, animation renommée (editFadeInUp), styles des options cards harmonisés avec step-details__* de CreateHabit."
        },
        {
          "id": "edit.8",
          "name": "Tests E2E édition habitude",
          "description": "Créer des tests E2E pour vérifier que toutes les nouvelles propriétés peuvent être modifiées correctement.",
          "status": "completed",
          "priority": "medium",
          "files": ["e2e/habit-edit.spec.ts"],
          "completedAt": "2026-01-11",
          "notes": "23 tests E2E créés couvrant: propriétés de base (nom, description), fréquence de suivi, mode de suivi, mode de saisie, déclaration d'identité, habit stacking, validation UX, progression, et emoji. Bug corrigé dans useAppData.ts (updateHabit retournait toujours false)."
        }
      ]
    },
    {
      "id": "phase-counter-types",
      "name": "Types et modèle de données Compteur",
      "status": "completed",
      "description": "Nouveaux types TypeScript pour le mode compteur avec historique des opérations",
      "tasks": [
        {
          "id": "counter.1",
          "name": "Étendre TrackingMode avec 'counter'",
          "description": "Modifier le type TrackingMode pour inclure 'counter' en plus de 'simple' et 'detailed'",
          "status": "completed",
          "priority": "high",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "counter.2",
          "name": "Créer interface CounterOperation",
          "description": "Nouvelle interface pour tracer chaque opération: id, type (add/subtract), value, timestamp, note optionnelle",
          "status": "completed",
          "priority": "high",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "counter.3",
          "name": "Ajouter operations[] à DailyEntry",
          "description": "Étendre DailyEntry avec un champ optionnel 'operations?: CounterOperation[]' pour l'historique",
          "status": "completed",
          "priority": "high",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "counter.4",
          "name": "Créer type WeeklyAggregation",
          "description": "Nouveau type 'count-days' | 'sum-units' pour les habitudes hebdomadaires",
          "status": "completed",
          "priority": "high",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "counter.5",
          "name": "Ajouter weeklyAggregation à Habit",
          "description": "Nouveau champ optionnel 'weeklyAggregation?: WeeklyAggregation' pour les habitudes weekly",
          "status": "completed",
          "priority": "high",
          "files": ["src/types/index.ts"],
          "completedAt": "2026-01-11"
        }
      ]
    }
  ],
  "stats": {
    "totalTasks": 59,
    "completed": 43,
    "inProgress": 0,
    "pending": 16
  },
  "nextPhases": [
    {
      "id": "phase-counter-logic",
      "name": "Logique métier Compteur",
      "status": "completed",
      "description": "Implémentation de la logique pour les opérations compteur et agrégation hebdomadaire",
      "tasks": [
        {
          "id": "logic.1",
          "name": "Fonction addCounterOperation dans useAppData",
          "description": "Nouvelle fonction pour ajouter une opération (add/subtract) à l'historique d'une entrée et recalculer actualValue",
          "status": "completed",
          "priority": "high",
          "files": ["src/hooks/useAppData.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "logic.2",
          "name": "Fonction undoLastOperation dans useAppData",
          "description": "Permet d'annuler la dernière opération d'un compteur (supprime le dernier élément de operations[])",
          "status": "completed",
          "priority": "high",
          "files": ["src/hooks/useAppData.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "logic.3",
          "name": "Fonction calculateCounterValue",
          "description": "Utilitaire pour calculer actualValue à partir de la liste des opérations",
          "status": "completed",
          "priority": "medium",
          "files": ["src/services/progression.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "logic.4",
          "name": "Logique agrégation count-days",
          "description": "Dans calculateWeeklyProgress, implémenter le comptage du nombre de jours réussis (vs somme des unités)",
          "status": "completed",
          "priority": "high",
          "files": ["src/services/progression.ts"],
          "completedAt": "2026-01-11"
        },
        {
          "id": "logic.5",
          "name": "Logique agrégation sum-units",
          "description": "Adapter calculateWeeklyProgress pour le mode sum-units (somme totale sur la semaine)",
          "status": "completed",
          "priority": "high",
          "files": ["src/services/progression.ts"],
          "completedAt": "2026-01-11"
        }
      ]
    },
    {
      "id": "phase-day-watch",
      "name": "Détection changement de journée",
      "status": "pending",
      "description": "Hook et logique pour détecter automatiquement le passage à un nouveau jour",
      "tasks": [
        {
          "id": "day.1",
          "name": "Créer hook useDateWatch",
          "description": "Hook qui vérifie toutes les minutes si la date a changé et déclenche un callback",
          "status": "pending",
          "priority": "high",
          "files": ["src/hooks/useDateWatch.ts"]
        },
        {
          "id": "day.2",
          "name": "Intégrer useDateWatch dans Today.tsx",
          "description": "Utiliser le hook pour re-render automatique à minuit sans refresh manuel",
          "status": "pending",
          "priority": "high",
          "files": ["src/pages/Today.tsx"]
        },
        {
          "id": "day.3",
          "name": "Notification nouvelle journée",
          "description": "Afficher un toast ou message discret lors du passage à un nouveau jour",
          "status": "pending",
          "priority": "low",
          "files": ["src/pages/Today.tsx", "src/constants/messages.ts"]
        }
      ]
    },
    {
      "id": "phase-counter-ui",
      "name": "Interface utilisateur Compteur",
      "status": "pending",
      "description": "Composants React pour l'interface des habitudes compteur",
      "tasks": [
        {
          "id": "ui.1",
          "name": "Créer composant CounterButtons",
          "description": "Boutons +1/-1 avec affichage du total, dernière action et bouton annuler",
          "status": "pending",
          "priority": "high",
          "files": ["src/components/habits/CounterButtons.tsx", "src/components/habits/CounterButtons.css"]
        },
        {
          "id": "ui.2",
          "name": "Intégrer CounterButtons dans HabitCard",
          "description": "Afficher CounterButtons au lieu de CheckInButtons si trackingMode='counter'",
          "status": "pending",
          "priority": "high",
          "files": ["src/components/habits/HabitCard.tsx"]
        },
        {
          "id": "ui.3",
          "name": "Couleurs selon direction pour compteur",
          "description": "+1 vert pour increase, -1 vert pour decrease (couleurs inversées selon contexte)",
          "status": "pending",
          "priority": "medium",
          "files": ["src/components/habits/CounterButtons.css"]
        },
        {
          "id": "ui.4",
          "name": "Option mode compteur dans CreateHabit",
          "description": "Ajouter le choix 'Compteur' (avec +/-) dans les options de trackingMode à la création",
          "status": "pending",
          "priority": "high",
          "files": ["src/pages/CreateHabit.tsx"]
        },
        {
          "id": "ui.5",
          "name": "Option agrégation hebdo dans CreateHabit",
          "description": "Si trackingFrequency=weekly, permettre de choisir count-days ou sum-units",
          "status": "pending",
          "priority": "high",
          "files": ["src/pages/CreateHabit.tsx"]
        },
        {
          "id": "ui.6",
          "name": "Édition mode compteur dans EditHabit",
          "description": "Permettre de modifier trackingMode vers/depuis 'counter' et weeklyAggregation",
          "status": "pending",
          "priority": "medium",
          "files": ["src/pages/EditHabit.tsx"]
        }
      ]
    },
    {
      "id": "phase-counter-migration",
      "name": "Migration schéma v9",
      "status": "pending",
      "description": "Migration des données existantes pour le nouveau schéma",
      "tasks": [
        {
          "id": "mig.1",
          "name": "Créer migration vers schéma v9",
          "description": "Ajouter weeklyAggregation='sum-units' par défaut aux habitudes weekly existantes",
          "status": "pending",
          "priority": "high",
          "files": ["src/services/migration.ts", "src/types/index.ts"]
        }
      ]
    },
    {
      "id": "phase-counter-tests",
      "name": "Tests Compteur",
      "status": "pending",
      "description": "Tests unitaires et E2E pour le mode compteur",
      "tasks": [
        {
          "id": "test.1",
          "name": "Tests unitaires CounterOperation",
          "description": "Tests pour calculateCounterValue, addCounterOperation, undoLastOperation",
          "status": "pending",
          "priority": "high",
          "files": ["src/services/progression.test.ts", "src/hooks/useAppData.test.ts"]
        },
        {
          "id": "test.2",
          "name": "Tests unitaires agrégation hebdomadaire",
          "description": "Tests pour count-days vs sum-units dans calculateWeeklyProgress",
          "status": "pending",
          "priority": "high",
          "files": ["src/services/progression.test.ts"]
        },
        {
          "id": "test.3",
          "name": "Tests E2E habitude compteur",
          "description": "Test création, +1, -1, annuler dernière action",
          "status": "pending",
          "priority": "high",
          "files": ["e2e/habit-counter.spec.ts"]
        },
        {
          "id": "test.4",
          "name": "Tests E2E agrégation hebdomadaire",
          "description": "Test count-days (jours réussis) vs sum-units (total semaine)",
          "status": "pending",
          "priority": "high",
          "files": ["e2e/habit-weekly-aggregation.spec.ts"]
        },
        {
          "id": "test.5",
          "name": "Fixture counter-operations.json",
          "description": "Fichier de test avec habitude compteur et historique d'opérations",
          "status": "pending",
          "priority": "medium",
          "files": ["public/test-data/habit-types/counter-operations.json"]
        }
      ]
    }
  ]
}
